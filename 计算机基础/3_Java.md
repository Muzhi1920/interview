# Java基础
## 一、死锁
>>定义
1. 集合中的每一个进程都在等待只能由本集合中的其他进程才能引发的事件，那么该组进程是死锁的。
2. 指两个或两个以上的进程（或线程）在执行过程中，因争夺资源而造成的一种相互等待的现象，若无外力作用，他们将无法推进下去。
产生锁的资源：线程池、网络连接池、通知事件，磁盘、带宽
### 1.1、产生死锁的必要条件
1. 资源互斥条件： 进程对于所分配到的资源具有排他性，一个资源只能由一个进程占用，知道该进程释放该资源。
2. 不可剥夺条件： 进程无法剥夺其他进程的资源，知道其他进程释放资源后才可能请求到。
3. 请求保持条件： 进程会请求所有需要的资源，如果过程中因为缺少资源而阻塞，已请求到的资源不会释放。
4. 循环等待条件： 死锁发生时，一定有两个或以上的进程形成环路，在等待下一个进程的某些资源，导致永久阻塞。
### 1.2、避免死锁
1. 以确定顺序获得锁\
   hashCode排序，顺序获得；多进程时使用银行家算法试探是否安全。
   **银行家算法**：当一个进程申请使用资源的时候，银行家算法通过先试探分配给该进程资源，然后通过安全性算法判断分配后的系统是否处于安全状态，若不安全则试探分配作废，让该进程继续等待。
2. 超时放弃
   按照固定时长等待锁，超时以后**主动释放之前已经获得的所有的锁**。
### 1.3、案例与解决办法
1. 线程池死锁：扩大线程池线程数 or 使任务结果之间不再互相依赖。
2. 两个线程A和B，两个数据库连接池N1和N2，A先N1后N2;B先N2后N1；且两个线程在完成执行之前都不释放自己已经持有的链接，因此也造成了死锁。


